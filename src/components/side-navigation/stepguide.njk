{% from "components/icons/icons--svg.njk" import icon_svg as icon_svg %}
{% from "components/overflow-menu/overflow-menu.njk" import overflowmenu as overflowmenu %}

{% macro stepguide(params) %}
{% set hasMaxWidth = params.hasMaxWidth | default(true) %}
<nav{% if hasMaxWidth %} class="sidebar-col"{% endif %}>
    <ul class="sidenav-list" role="menu">
        {% for trin in params.steps %}
        {% set disabled = trin.disabled | default(false) %}
        <li{% if disabled or trin.active or trin.error %} class="{% if disabled %}disabled {% endif %}{% if trin.active %}active current {% endif %}{% if trin.error %}sidenav-error{% endif %}"{% endif %} role="none">
            <a {% if not disabled %}href="{{trin.href}}" {% endif %}role="menuitem"{% if trin.active %} aria-current="page"{% endif %}>
                <span class="sidenav-number">{{loop.index}}.</span>
                <div>
                    <span>{{trin.text}}</span>
                    {% if trin.information %}
                    <span class="sidenav-information">{{trin.information}}</span>
                    {% endif %}
                </div>
                {% if trin.icon %}
                <span class="sidenav-icon{%if trin.iconclass %} {{ trin.iconclass }}{% endif %}">
                    {{ icon_svg(trin.icon) }}
                </span>
                {% endif %}
            </a>
        </li>{% endfor %}
    </ul>
</nav>
{% endmacro %}

{% macro overflow_stepguide(params) %}
{% set hasMaxWidth = params.hasMaxWidth | default(true) %}
{% set stepsTotal = params.steps | length %}
{% set currentStep = 0 %}
{% for trin in params.steps %}
    {% if trin.active %}
        {% set currentStep = loop.index %}
    {% endif %}
{% endfor %}
{% set buttonText = "Trin " + currentStep + " af " + stepsTotal %}
{% set breakpointClass = "overflow-menu--lg-no-responsive" %}
{% if params.mediumHide %}
    {% set breakpointClass = "overflow-menu--md-no-responsive" %}
{% endif %}
{% if hasMaxWidth %}
    {% set breakpointClass = breakpointClass + " sidebar-col" %}
{% endif %}
{% if params.responsive %}
{{ 
    overflowmenu({
        "button": {
            "text": buttonText,
            "icon": "arrow-drop-down"
        },
        "classes": breakpointClass,
        "id": params.id,
        "openRight": params.openRight,
        "content": stepguide(params)
    }) 
}}
{% elif hasMaxWidth %}
{{ 
    overflowmenu({
        "button": {
            "text": buttonText,
            "icon": "arrow-drop-down"
        },
        "classes": "sidebar-col",
        "id": params.id,
        "openRight": params.openRight,
        "content": stepguide(params)
    }) 
}}
{% else %}
{{ 
    overflowmenu({
        "button": {
            "text": buttonText,
            "icon": "arrow-drop-down"
        },
        "id": params.id,
        "openRight": params.openRight,
        "content": stepguide(params)
    }) 
}}
{% endif %}
{% endmacro %}
